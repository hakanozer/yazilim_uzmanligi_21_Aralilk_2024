import './polyfills.server.mjs';
import{a as j}from"./chunk-QYNS3MQJ.mjs";import{g as K,k as R,n as z}from"./chunk-NZ74Z4VB.mjs";import{a as $}from"./chunk-5QQXOPCN.mjs";import{a as B}from"./chunk-POUQEJGM.mjs";import{Ab as N,Bb as D,Cb as T,Ha as f,Jb as M,S as g,X as w,Y as x,bb as h,cb as v,db as m,ea as _,eb as o,fb as s,gb as p,kb as I,lb as y,mb as S,pc as O,qc as C,tb as l,ub as u,vb as E,xa as r,xb as k,xc as F}from"./chunk-GNGZ4DYW.mjs";import"./chunk-T55IDOPT.mjs";var A=n=>["/courses",n],J=(n,t)=>t.id;function U(n,t){if(n&1){let e=I();o(0,"div",4)(1,"div",5),p(2,"img",6),o(3,"div",7)(4,"h5",8),l(5),s(),o(6,"p",9),l(7),s(),o(8,"p",10),l(9),s(),o(10,"div",11)(11,"strong"),l(12),D(13,"currency"),s(),o(14,"div",12)(15,"button",13),y("click",function(){let a=w(e).$implicit,d=S();return x(d.enroll(a.id))}),l(16),s(),o(17,"a",14),l(18,"Detay"),s()()()()()()}if(n&2){let e=t.$implicit,i=S();r(2),m("alt",k(e.title))("ngSrc",e.image||"assets/logo.png"),r(3),u(e.title),r(2),u(e.instructorName),r(2),u(e.description),r(3),u(T(13,10,e.price,"TRY")),r(3),m("disabled",i.enrolling.has(e.id)||i.enrolled.has(e.id)),r(),E(" ",i.enrolled.has(e.id)?"Kay\u0131t Olundu":"Kay\u0131t Ol"," "),r(),m("routerLink",N(13,A,e.id))}}var b=class n{courses=[];enrolling=new Set;enrolled=new Set;enroll;static \u0275fac=function(e){return new(e||n)};static \u0275cmp=f({type:n,selectors:[["app-courses-item"]],inputs:{courses:"courses",enrolling:"enrolling",enrolled:"enrolled",enroll:"enroll"},decls:8,vars:0,consts:[[1,"container","mt-5"],[1,"row"],[1,"col-12","mt-5"],[1,"row","mt-3","g-3"],[1,"col-md-4"],[1,"card","h-100"],["width","160","height","160","priority","",1,"card-img-top",2,"object-fit","cover","height","auto",3,"ngSrc","alt"],[1,"card-body","d-flex","flex-column"],[1,"card-title"],[1,"card-text","text-muted"],[1,"card-text"],[1,"mt-auto","d-flex","justify-content-between","align-items-center"],[1,"btn-group"],[1,"btn","btn-primary","btn-sm",3,"click","disabled"],[1,"btn","btn-outline-secondary","btn-sm",3,"routerLink"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),l(4,"Kurslar"),s()(),o(5,"div",3),h(6,U,19,15,"div",4,J),s()()()),e&2&&(r(6),v(i.courses))},dependencies:[C,F,z,R,O],encapsulation:2})};var Y=(n,t)=>t.id;function q(n,t){if(n&1&&(o(0,"option",5),l(1),s()),n&2){let e=t.$implicit;m("value",e.id),r(),u(e.name)}}var L=class n{api=g($);route=g(K);enrollmentEvents=g(j);courses=[];categories=[];selectedCategory=_("");filtered=M(()=>{let t=this.selectedCategory();return t?this.courses.filter(e=>e&&e.categoryId===t):this.courses});enrolling=new Set;enrolled=new Set;loading=!0;error=!1;http;ngOnInit(){let t=this.route.snapshot.data.courses;try{t&&(this.courses=[...t]),this.loading=!1}catch{this.loading=!1,this.error=!0}let e=typeof window<"u"?localStorage.getItem("currentUser"):null,i=e?JSON.parse(e):null;i&&this.api.list("enrollments?userId="+i.id).subscribe(a=>{for(let d of a)this.enrolled.add(d.courseId)}),this.api.list("categories").subscribe(a=>this.categories=a)}enroll=t=>{if(this.enrolled.has(t)){alert("Bu kursa zaten kay\u0131tl\u0131s\u0131n\u0131z");return}this.enrolling=new Set([...this.enrolling,t]);let e=typeof window<"u"?localStorage.getItem("currentUser"):null,i=e?JSON.parse(e):null;i&&this.api.list("enrollments",{userId:i.id,courseId:t}).subscribe(a=>{if(a.length){let c=new Set(this.enrolling);c.delete(t),this.enrolling=c,this.enrolled=new Set([...this.enrolled,t]),alert("Bu kursa zaten kay\u0131tl\u0131s\u0131n\u0131z");return}let d={userId:i.id,courseId:t};this.api.post("enrollments",d).subscribe({next:()=>{let c=new Set(this.enrolling);c.delete(t),this.enrolling=c,this.enrolled=new Set([...this.enrolled,t]),this.enrollmentEvents.notifyEnrollment(),alert("Kursa kay\u0131t yap\u0131ld\u0131")},error:()=>{let c=new Set(this.enrolling);c.delete(t),this.enrolling=c,alert("Kay\u0131t s\u0131ras\u0131nda hata olu\u015Ftu")}})})};refreshCourses(){this.loading=!0,this.error=!1,this.api.list("courses").subscribe({next:t=>{this.courses=[...t],this.loading=!1},error:()=>{this.loading=!1,this.error=!0}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=f({type:n,selectors:[["app-courses"]],decls:10,vars:4,consts:[[1,"container","mt-5","pt-4"],[1,"row","mb-3"],[1,"col-md-4"],[1,"form-select",3,"change"],["value",""],[3,"value"],[3,"courses","enrolling","enrolled","enroll"]],template:function(e,i){e&1&&(p(0,"app-background-item"),o(1,"div",0)(2,"div",1)(3,"div",2)(4,"select",3),y("change",function(d){return i.selectedCategory.set(d.target.value)}),o(5,"option",4),l(6,"T\xFCm Kategoriler"),s(),h(7,q,2,2,"option",5,Y),s()()()(),p(9,"app-courses-item",6)),e&2&&(r(7),v(i.categories),r(2),m("courses",i.filtered())("enrolling",i.enrolling)("enrolled",i.enrolled)("enroll",i.enroll))},dependencies:[C,B,b],encapsulation:2,changeDetection:0})};export{L as Courses};

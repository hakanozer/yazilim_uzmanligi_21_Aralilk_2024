import './polyfills.server.mjs';
import{a as G}from"./chunk-DMR4W55G.mjs";import{a as $}from"./chunk-2T7BWYOE.mjs";import{g as H}from"./chunk-NZ74Z4VB.mjs";import{a as x}from"./chunk-5QQXOPCN.mjs";import{A as k,Bb as D,Cb as E,Db as z,Ha as F,Jb as w,K as N,La as g,N as O,S as d,X as y,Y as I,db as c,ea as l,eb as n,fb as r,gb as T,j as C,kb as A,lb as S,mb as f,mc as V,nc as B,o as M,oc as L,pc as K,qb as R,qc as Y,tb as o,ub as p,va as j,vb as v,wb as U,xa as a,xb as P}from"./chunk-GNGZ4DYW.mjs";import{a as _,b}from"./chunk-T55IDOPT.mjs";var h=class i{api=d(x);cache=d(G);loading=l(!1);key="userMapAll";getAllMap(){let t=this.cache.get(this.key);return t?C(t):this.loading()?C({}):(this.loading.set(!0),this.api.list("users").pipe(M(e=>{let s={};for(let m of e){let u=[m.name,m.surname].filter(Boolean).join(" ").trim();s[m.id]=u||m.email||m.id}return this.cache.set(this.key,s,5*6e4),s}),N({next:()=>this.loading.set(!1),error:()=>this.loading.set(!1)})))}static \u0275fac=function(e){return new(e||i)};static \u0275prov=O({token:i,factory:i.\u0275fac,providedIn:"root"})};function X(i,t){if(i&1&&(n(0,"li",21)(1,"span"),o(2),r(),n(3,"span",22),o(4),r()()),i&2){let e=t.$implicit;a(2),p(e.title),a(2),v("",e.durationMin," dk")}}function Z(i,t){if(i&1){let e=A();n(0,"div",23)(1,"textarea",24),S("input",function(m){y(e);let u=f(2);return I(u.newComment.set(m.target.value))}),r(),n(2,"button",25),S("click",function(){y(e);let m=f(2);return I(m.addComment())}),o(3,"G\xF6nder"),r()()}if(i&2){let e=f(2);a(),c("value",e.newComment()),a(),c("disabled",e.posting()||!e.newComment().trim())}}function ee(i,t){i&1&&(n(0,"div",26),o(1,"Hen\xFCz yorum yok."),r())}function te(i,t){if(i&1&&(n(0,"div",27)(1,"div",28)(2,"strong"),o(3),r(),n(4,"span",26),o(5),D(6,"date"),r()(),n(7,"div"),o(8),r()()),i&2){let e=t.$implicit;a(3),p(e.authorName||e.userId),a(2),p(E(6,3,e.createdAt,"short")),a(3),p(e.text)}}function ie(i,t){if(i&1&&(n(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h2"),o(5),r(),n(6,"p",6),o(7),r(),n(8,"p"),o(9),r(),n(10,"div",7),o(11),r(),n(12,"h4",8),o(13,"Dersler"),r(),n(14,"ul",9),g(15,X,5,2,"li",10),r(),n(16,"h4"),o(17,"Yorumlar"),r(),g(18,Z,4,2,"div",11)(19,ee,2,0,"div",12),n(20,"div",13),g(21,te,9,6,"div",14),r()(),n(22,"div",15)(23,"div",16),T(24,"img",17),n(25,"div",18),o(26),D(27,"currency"),r(),n(28,"div",19),o(29),r(),n(30,"a",20),o(31,"T\xFCm Kurslar"),r()()()()()()),i&2){let e=f();a(5),p(e.course().title),a(2),v("E\u011Fitmen: ",e.course().instructorName),a(2),p(e.course().description),a(2),U("Seviye: ",e.course().level," \u2022 S\xFCre: ",e.course().durationHours," saat"),a(4),c("ngForOf",e.lessons()),a(3),c("ngIf",e.canComment()),a(),c("ngIf",!e.comments().length),a(2),c("ngForOf",e.comments()),a(3),c("alt",P(e.course().title))("src",e.course().image||"assets/logo.png",j),a(2),p(E(27,14,e.course().price,"TRY")),a(3),v("Kategori: ",e.course().categoryId)}}function ne(i,t){i&1&&(n(0,"div",29),o(1,"Kurs bulunamad\u0131."),r())}var q=class i{route=d(H);api=d(x);auth=d($);userLookup=d(h);data=this.route.snapshot.data.detail;course=l(this.data?.course??null);lessons=l(this.data?.lessons??[]);comments=l(this.data?.comments??[]);newComment=l("");posting=l(!1);userMap=l({});ngOnInit(){this.userLookup.getAllMap().pipe(k(1)).subscribe({next:t=>{t&&Object.keys(t).length&&(this.userMap.set(t),this.decorateExistingComments())},error:()=>{}})}decorateExistingComments(){let t=this.userMap(),e=this.comments().map(s=>b(_({},s),{authorName:t[s.userId]||s.userId}));this.comments.set(e)}isStudent=w(()=>this.auth.currentUser()?.role==="student");canComment=w(()=>!!this.auth.currentUser()&&this.isStudent());addComment(){if(!this.canComment()||!this.course()||!this.newComment().trim())return;let t=this.auth.currentUser();if(!t)return;this.posting.set(!0);let e={courseId:this.course().id,userId:t.id,text:this.newComment().trim(),createdAt:new Date().toISOString()};this.api.post("comments",e).subscribe({next:s=>{let m=this.userMap(),u=String(t.id),J=[t.name,t.surname].filter(Boolean).join(" ").trim(),Q=m[u]||J||u;this.comments.set([b(_({},s),{authorName:Q}),...this.comments()]),this.newComment.set(""),this.posting.set(!1)},error:()=>this.posting.set(!1)})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=F({type:i,selectors:[["app-course-detail"]],decls:3,vars:2,consts:[["notfound",""],["class","course-detail-wrapper d-flex justify-content-center align-items-start pt-5 pb-5",4,"ngIf","ngIfElse"],[1,"course-detail-wrapper","d-flex","justify-content-center","align-items-start","pt-5","pb-5"],[1,"container",2,"max-width","1000px"],[1,"row","g-4"],[1,"col-lg-8"],[1,"text-muted","mb-1"],[1,"small","text-secondary","mb-3"],[1,"mt-4"],[1,"list-group","mb-4"],["class","list-group-item d-flex justify-content-between align-items-center",4,"ngFor","ngForOf"],["class","mb-3",4,"ngIf"],["class","text-muted small",4,"ngIf"],[1,"list-group"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"col-lg-4"],[1,"card","p-3"],[1,"img-fluid","mb-3",2,"object-fit","cover","max-height","200px",3,"src","alt"],[1,"h5","mb-3"],[1,"small","text-secondary","mb-2"],["routerLink","/courses",1,"btn","btn-outline-secondary","btn-sm"],[1,"list-group-item","d-flex","justify-content-between","align-items-center"],[1,"badge","bg-light","text-dark"],[1,"mb-3"],["rows","2","placeholder","Yorum yaz...",1,"form-control","mb-2",3,"input","value"],[1,"btn","btn-sm","btn-primary",3,"click","disabled"],[1,"text-muted","small"],[1,"list-group-item"],[1,"d-flex","justify-content-between","align-items-center"],[1,"container","py-5","text-center","text-muted"]],template:function(e,s){if(e&1&&g(0,ie,32,17,"div",1)(1,ne,2,0,"ng-template",null,0,z),e&2){let m=R(2);c("ngIf",s.course())("ngIfElse",m)}},dependencies:[Y,V,B,K,L],styles:[".course-detail-wrapper[_ngcontent-%COMP%]{min-height:calc(100vh - 70px);padding-top:6rem!important}.list-group-item[_ngcontent-%COMP%]{font-size:14px}textarea[_ngcontent-%COMP%]{resize:vertical}"]})};export{q as CourseDetail};

import './polyfills.server.mjs';
import{a as J}from"./chunk-DMR4W55G.mjs";import{a as Y}from"./chunk-2T7BWYOE.mjs";import{a as q}from"./chunk-QYNS3MQJ.mjs";import{g as K,n as L}from"./chunk-NZ74Z4VB.mjs";import{a as G}from"./chunk-5QQXOPCN.mjs";import{a as V}from"./chunk-POUQEJGM.mjs";import{$a as m,Bb as D,Cb as N,Ha as O,Jb as b,Kb as k,S as C,_a as c,bb as v,cb as x,db as T,ea as y,eb as o,fb as s,gb as f,j as $,mb as u,pc as j,qc as z,sb as A,tb as l,u as B,ub as p,va as M,vb as g,wb as H,xa as r,xb as R}from"./chunk-GNGZ4DYW.mjs";import{a as w,b as U}from"./chunk-T55IDOPT.mjs";var S=(n,i)=>i.id;function X(n,i){if(n&1&&(o(0,"span",11),l(1),s()),n&2){let e=u();A("bg-primary",(e.user==null?null:e.user.role)==="student")("bg-warning",(e.user==null?null:e.user.role)==="instructor")("text-dark",(e.user==null?null:e.user.role)==="instructor"),r(),g(" ",(e.user==null?null:e.user.role)==="student"?"\xD6\u011Frenci":"E\u011Fitici"," ")}}function Z(n,i){n&1&&(o(0,"div",9)(1,"div",12)(2,"span",13),l(3,"Y\xFCkleniyor..."),s()(),o(4,"div"),l(5,"Profil verileri y\xFCkleniyor..."),s()())}function ee(n,i){n&1&&(o(0,"div",10),l(1,"Hen\xFCz g\xF6r\xFCnt\xFClenecek kurs bulunmuyor."),s())}function te(n,i){if(n&1&&(o(0,"div",14)(1,"div",15),l(2),s(),o(3,"div",15),l(4),s(),o(5,"div",15),l(6),D(7,"currency"),s()()),n&2){let e=u(2);r(2),g("Kurs Say\u0131s\u0131: ",e.studentMetrics().courseCount),r(2),g("Toplam S\xFCre: ",e.studentMetrics().totalHours,"s"),r(2),g("Toplam Tutar: ",N(7,3,e.studentMetrics().totalPrice,"TRY"))}}function ie(n,i){if(n&1&&(o(0,"div",14)(1,"div",15),l(2),s(),o(3,"div",15),l(4),s()()),n&2){let e=u(2);r(2),g("E\u011Fitim Say\u0131s\u0131: ",e.instructorMetrics().courseCount),r(2),g("Toplam \xD6\u011Frenci: ",e.instructorMetrics().totalStudents)}}function ne(n,i){if(n&1&&(o(0,"div",18)(1,"div",19),f(2,"img",20),o(3,"div",21)(4,"h5",22),l(5),s(),o(6,"p",23),l(7),s(),o(8,"p",24),l(9),s(),o(10,"div",25)(11,"strong"),l(12),D(13,"currency"),s()()()()()),n&2){let e=i.$implicit;r(2),T("alt",R(e.title))("src",e.image||"assets/logo.png",M),r(3),p(e.title),r(2),p(e.instructorName),r(2),p(e.description),r(3),p(N(13,7,e.price,"TRY"))}}function re(n,i){if(n&1&&(o(0,"div",17)(1,"h6"),l(2),s()(),v(3,ne,14,10,"div",18,S)),n&2){let e=u().$implicit,t=u(3);r(2),p(e.name),r(),x(t.groupedCourses()[e.id])}}function oe(n,i){if(n&1&&c(0,re,5,1),n&2){let e=i.$implicit,t=u(3);m(t.groupedCourses()[e.id]&&t.groupedCourses()[e.id].length?0:-1)}}function se(n,i){if(n&1&&(o(0,"h5"),l(1,"Al\u0131nan Kurslar"),s(),o(2,"div",16),v(3,oe,1,1,null,null,S),s()),n&2){let e=u(2);r(3),x(e.categories())}}function le(n,i){if(n&1&&(o(0,"li"),l(1),s()),n&2){let e=i.$implicit;r(),p(e.title)}}function ae(n,i){if(n&1&&(o(0,"h6"),l(1),s(),o(2,"ul",26),v(3,le,2,1,"li",null,S),s()),n&2){let e=u().$implicit,t=u(3);r(),p(e.name),r(2),x(t.groupedCourses()[e.id])}}function ue(n,i){if(n&1&&c(0,ae,5,1),n&2){let e=i.$implicit,t=u(3);m(t.groupedCourses()[e.id]&&t.groupedCourses()[e.id].length?0:-1)}}function de(n,i){if(n&1&&(o(0,"h5"),l(1,"Verilen Kurslar"),s(),v(2,ue,1,1,null,null,S)),n&2){let e=u(2);r(2),x(e.categories())}}function ce(n,i){if(n&1&&(c(0,te,8,6,"div",14),c(1,ie,5,2,"div",14),c(2,se,5,0),c(3,de,4,0)),n&2){let e=u();m((e.user==null?null:e.user.role)==="student"?0:-1),r(),m((e.user==null?null:e.user.role)==="instructor"?1:-1),r(),m(!(e.user!=null&&e.user.role)||(e.user==null?null:e.user.role)==="student"?2:-1),r(),m((e.user==null?null:e.user.role)==="instructor"?3:-1)}}var Q=class n{auth=C(Y);api=C(G);enrollmentEvents=C(q);route=C(K);cache=C(J);user=null;profilePhoto="assets/logo.png";categories=y([]);groupedCourses=y({});allCourses=y([]);loading=y(!0);empty=b(()=>!this.loading()&&Object.keys(this.groupedCourses()).length===0);studentCourseList=b(()=>{if(!this.user||this.user.role!=="student")return[];let i=this.groupedCourses(),e=[];for(let t of Object.keys(i))e.push(...i[t]);return e});studentMetrics=b(()=>{if(!this.user||this.user.role!=="student")return{courseCount:0,totalPrice:0,totalHours:0};let i=this.studentCourseList(),e=0,t=0;for(let a of i)typeof a.price=="number"&&(e+=a.price),typeof a.durationHours=="number"&&(t+=a.durationHours);return{courseCount:i.length,totalPrice:Number(e.toFixed(2)),totalHours:t}});instructorMetrics=b(()=>{if(this.user?.role!=="instructor")return{courseCount:0,totalStudents:0};let e=this.allCourses().filter(d=>d.instructorId===this.user?.id),t=e.length,a=e.reduce((d,h)=>d+(Array.isArray(h.students)?h.students.length:0),0);return{courseCount:t,totalStudents:a}});_enrollmentEffect=k(()=>{this.enrollmentEvents.version(),this.user&&(this.user.role&&this.user.role!=="student"||this.allCourses().length&&(this.cache.clear(`profile:${this.user.id}`),this.recomputeStudentGrouping()))});_userSyncEffect=k(()=>{let i=this.auth.currentUser();if(!i||this.user&&this.user.id===i.id)return;let e=!this.user;if(this.applyUser(i,!0),e&&!this.allCourses().length){this.loading.set(!0);let t=(i.role||"student")==="student",a=this.api.list("categories"),d=this.api.list("courses"),h=t?this.api.list("enrollments",{userId:i.id}):$([]);B({categories:a,courses:d,enrollments:h}).subscribe(({categories:_,courses:E,enrollments:W})=>{if(this.categories.set(_),this.allCourses.set(E),t){let I=new Set(W.map(F=>F.courseId)),P=E.filter(F=>I.has(F.id));this.groupedCourses.set(this.groupByCategory(P))}else{let I=E.filter(P=>P.instructorId===i.id);this.groupedCourses.set(this.groupByCategory(I))}this.loading.set(!1)})}});ngOnInit(){let i=this.auth.currentUser();i&&this.applyUser(i,!1);let e=this.route.snapshot.data.profileData;if(e){this.categories.set(e.categories||[]);let t=e.courses||[];if(this.allCourses.set(t),this.user?.role==="instructor"){let a=t.filter(d=>d.instructorId===this.user.id);this.groupedCourses.set(this.groupByCategory(a)),this.loading.set(!1)}else{let a=e.enrollments||[],d=new Set(a.map(_=>_.courseId)),h=t.filter(_=>d.has(_.id));this.groupedCourses.set(this.groupByCategory(h)),this.loading.set(!1)}}else this.loading.set(!1)}refetchEnrollments(){!this.user||this.user.role!=="student"||this.api.list("enrollments",{userId:this.user.id}).subscribe(i=>{let e=new Set(i.map(a=>a.courseId)),t=this.allCourses().filter(a=>e.has(a.id));this.groupedCourses.set(this.groupByCategory(t))})}recomputeStudentGrouping(){this.refetchEnrollments()}ngOnDestroy(){}groupByCategory(i){let e={};for(let t of i)e[t.categoryId]=e[t.categoryId]||[],e[t.categoryId].push(t);return e}applyUser(i,e){let t=i;if(i.role||(t=U(w({},i),{role:"student"}),localStorage.setItem("currentUser",JSON.stringify(t)),this.auth.currentUser.set(t)),this.user=t,this.profilePhoto=t.profilePhoto||this.profilePhoto,this.allCourses().length){if(t.role==="instructor"){let a=this.allCourses().filter(d=>d.instructorId===t.id);this.groupedCourses.set(this.groupByCategory(a))}else this.refetchEnrollments();this.loading.set(!1)}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=O({type:n,selectors:[["app-profile"]],decls:17,vars:6,consts:[[1,"row","mt-5","p-5"],[1,"col-3"],[1,"col-6"],[1,"card","p-3"],[1,"text-center"],["width","120","height","120","alt","Profil Foto\u011Fraf\u0131",1,"rounded-circle","mx-auto","d-block",3,"src"],[1,"mt-2","mb-1"],[1,"mb-1"],[1,"badge",3,"bg-primary","bg-warning","text-dark"],[1,"d-flex","flex-column","align-items-center","py-4","text-muted"],[1,"alert","alert-info","m-0"],[1,"badge"],["role","status",1,"spinner-border","mb-3",2,"width","2.5rem","height","2.5rem"],[1,"visually-hidden"],[1,"d-flex","gap-2","flex-wrap","mb-3"],[1,"badge","bg-secondary"],[1,"row","mt-3","g-3"],[1,"col-12"],[1,"col-md-4"],[1,"card","h-100"],["width","160","height","160",1,"card-img-top",2,"object-fit","cover","height","auto",3,"src","alt"],[1,"card-body","d-flex","flex-column"],[1,"card-title"],[1,"card-text","text-muted"],[1,"card-text"],[1,"mt-auto","d-flex","justify-content-between","align-items-center"],[1,"mb-3"]],template:function(e,t){e&1&&(f(0,"app-background-item"),o(1,"div",0),f(2,"div",1),o(3,"div",2)(4,"div",3)(5,"div",4),f(6,"img",5),o(7,"h3",6),l(8),s(),o(9,"p",7),l(10),s(),c(11,X,2,7,"span",8),s(),f(12,"hr"),c(13,Z,6,0,"div",9)(14,ee,2,0,"div",10)(15,ce,4,4),s()(),f(16,"div",1),s()),e&2&&(r(6),T("src",t.profilePhoto,M),r(2),H("",t.user==null?null:t.user.name," ",t.user==null?null:t.user.surname),r(2),p(t.user==null?null:t.user.email),r(),m(t.user!=null&&t.user.role?11:-1),r(2),m(t.loading()?13:t.empty()?14:15))},dependencies:[V,z,L,j],encapsulation:2})};export{Q as Profile};

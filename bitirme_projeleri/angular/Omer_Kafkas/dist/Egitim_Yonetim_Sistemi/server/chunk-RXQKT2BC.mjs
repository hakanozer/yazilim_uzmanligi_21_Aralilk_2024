import './polyfills.server.mjs';
import{a as D,b as d,c as M,d as V,f as T,g as A,i as B,j as q,k as H,l as L,m as U,n as G,p as K}from"./chunk-6M6XI24X.mjs";import{a as $}from"./chunk-2T7BWYOE.mjs";import{a as j}from"./chunk-5QQXOPCN.mjs";import{$a as v,Ha as I,Jb as h,S as y,X as m,Y as p,_a as _,bb as S,cb as N,db as f,ea as c,eb as n,fb as i,gb as g,kb as b,lb as C,mb as u,qc as F,sb as k,tb as o,ub as E,wb as w,xa as a}from"./chunk-GNGZ4DYW.mjs";import"./chunk-T55IDOPT.mjs";var P=(r,e)=>e.id;function Y(r,e){r&1&&(n(0,"div",2),g(1,"div",4),n(2,"span"),o(3,"Y\xFCkleniyor..."),i()())}function z(r,e){if(r&1){let t=b();n(0,"button",31),C("click",function(){let l=m(t).$implicit,x=u(2);return p(x.edit(l))}),n(1,"span",32)(2,"strong",33),o(3),i(),n(4,"small",34),o(5),i()(),n(6,"span",35),o(7),i()()}if(r&2){let t=e.$implicit,s=u(2);k("active",s.selectedCourseId()===t.id),a(3),E(t.title),a(2),w("\u20BA",t.price," \u2022 ",t.durationHours," saat"),a(2),E(t.level)}}function R(r,e){r&1&&(n(0,"div",11),o(1,"Kurs yok"),i())}function J(r,e){if(r&1&&(n(0,"option",19),o(1),i()),r&2){let t=e.$implicit;f("value",t.id),a(),E(t.name)}}function Q(r,e){if(r&1){let t=b();n(0,"button",36),C("click",function(){m(t);let l=u(2);return p(l.remove(l.form.value))}),o(1,"Sil"),i()}}function W(r,e){r&1&&(n(0,"div",29),o(1,"\xD6nce bir kurs se\xE7 / kaydet."),i())}function X(r,e){if(r&1){let t=b();n(0,"form",14),C("ngSubmit",function(){m(t);let l=u(2);return p(l.addLesson())}),g(1,"input",37)(2,"input",38),n(3,"button",39),o(4,"Ekle"),i()()}if(r&2){let t=u(2);f("formGroup",t.lessonForm),a(3),f("disabled",t.addingLesson())}}function Z(r,e){if(r&1){let t=b();n(0,"div",3)(1,"div",5)(2,"div",6)(3,"h5",7),o(4,"Kurslar\u0131m"),i(),n(5,"button",8),C("click",function(){m(t);let l=u();return p(l.newCourse())}),o(6,"Yeni"),i()(),n(7,"div",9),S(8,z,8,6,"button",10,P),_(10,R,2,0,"div",11),i()(),n(11,"div",12)(12,"h5",13),o(13,"Kurs Formu"),i(),n(14,"form",14),C("ngSubmit",function(){m(t);let l=u();return p(l.save())}),g(15,"input",15)(16,"textarea",16),n(17,"select",17)(18,"option",18),o(19,"Kategori se\xE7"),i(),S(20,J,2,2,"option",19,P),i(),n(22,"div",20),g(23,"input",21)(24,"input",22),i(),n(25,"div",20)(26,"select",23)(27,"option"),o(28,"Ba\u015Flang\u0131\xE7"),i(),n(29,"option"),o(30,"Orta"),i(),n(31,"option"),o(32,"\u0130leri"),i()(),g(33,"input",24),i(),n(34,"div",25)(35,"button",26),o(36,"Kaydet"),i(),_(37,Q,2,0,"button",27),i()()(),n(38,"div",28)(39,"h5",13),o(40,"Ders Ekle"),i(),_(41,W,2,0,"div",29)(42,X,5,2,"form",30),i()()}if(r&2){let t=u();a(8),N(t.filteredCourses()),a(2),v(t.filteredCourses().length?-1:10),a(4),f("formGroup",t.form),a(6),N(t.categories()),a(15),f("disabled",t.saving()),a(2),v(t.form.value.id?37:-1),a(4),v(t.selectedCourse()?42:41)}}var O=class r{api=y(j);auth=y($);fb=y(G);loading=c(!0);saving=c(!1);addingLesson=c(!1);courses=c([]);categories=c([]);selectedCourseId=c("");form=this.fb.group({id:[""],title:["",d.required],description:["",d.required],categoryId:["",d.required],price:[0,[d.required,d.min(0)]],durationHours:[0,[d.required,d.min(1)]],level:["Ba\u015Flang\u0131\xE7",d.required],image:[""]});lessonForm=this.fb.group({title:["",d.required],durationMin:[10,[d.required,d.min(1)]]});currentUser=h(()=>this.auth.currentUser());instructorId=h(()=>this.currentUser()?.id||"");filteredCourses=h(()=>this.courses().filter(e=>e.instructorId===this.instructorId()));selectedCourse=h(()=>this.filteredCourses().find(e=>e.id===this.selectedCourseId()));constructor(){let e=this.auth.currentUser();!e||e.role!=="instructor"||this.loadInitial()}loadInitial(){this.loading.set(!0),this.api.list("categories").subscribe(e=>this.categories.set(e)),this.api.list("courses").subscribe(e=>{this.courses.set(e),this.loading.set(!1)})}edit(e){this.form.reset({id:e.id,title:e.title,description:e.description,categoryId:e.categoryId,price:e.price,durationHours:e.durationHours,level:e.level||"Ba\u015Flang\u0131\xE7",image:e.image||""}),this.selectedCourseId.set(e.id)}newCourse(){this.form.reset({id:"",title:"",description:"",categoryId:"",price:0,durationHours:1,level:"Ba\u015Flang\u0131\xE7",image:""}),this.selectedCourseId.set("")}save(){if(this.form.invalid||!this.instructorId()){this.form.markAllAsTouched();return}let e=this.form.value,t={title:e.title,description:e.description,categoryId:e.categoryId,price:Number(e.price),durationHours:Number(e.durationHours),level:e.level,image:e.image,instructorId:this.instructorId(),instructorName:[this.currentUser()?.name,this.currentUser()?.surname].filter(Boolean).join(" ").trim(),instructorPhoto:this.currentUser()?.profilePhoto||"assets/logo.png"};this.saving.set(!0),e.id?this.api.put(`courses/${e.id}`,t).subscribe(s=>{let l=this.courses().map(x=>x.id===e.id?s:x);this.courses.set(l),this.saving.set(!1)}):this.api.post("courses",t).subscribe(s=>{this.courses.set([...this.courses(),s]),this.saving.set(!1),this.form.patchValue({id:s.id}),this.selectedCourseId.set(s.id)})}remove(e){confirm("Silmek istedi\u011Finize emin misiniz?")&&this.api.delete(`courses/${e.id}`).subscribe(()=>{this.courses.set(this.courses().filter(t=>t.id!==e.id)),this.selectedCourseId()===e.id&&this.newCourse()})}addLesson(){if(this.lessonForm.invalid||!this.selectedCourse()){this.lessonForm.markAllAsTouched();return}let e=this.lessonForm.value,t={courseId:this.selectedCourseId(),title:e.title,durationMin:Number(e.durationMin)};this.addingLesson.set(!0),this.api.post("lessons",t).subscribe({next:()=>{this.addingLesson.set(!1),this.lessonForm.reset({title:"",durationMin:10}),alert("Ders eklendi")},error:()=>{this.addingLesson.set(!1),alert("Ders eklenemedi")}})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=I({type:r,selectors:[["app-edit-courses"]],decls:5,vars:1,consts:[[1,"container","py-5","mt-5"],[1,"mb-4"],[1,"d-flex","gap-2","align-items-center","text-muted"],[1,"row","g-4"],[1,"spinner-border","spinner-border-sm"],[1,"col-md-4"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"m-0"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"list-group","small",2,"max-height","420px","overflow","auto"],["type","button",1,"list-group-item","list-group-item-action","d-flex","justify-content-between","align-items-center",3,"active"],[1,"list-group-item","text-muted"],[1,"col-md-5"],[1,"mb-3"],[1,"vstack","gap-2",3,"ngSubmit","formGroup"],["type","text","placeholder","Ba\u015Fl\u0131k","formControlName","title",1,"form-control"],["rows","3","placeholder","A\xE7\u0131klama","formControlName","description",1,"form-control"],["formControlName","categoryId",1,"form-select"],["value","","disabled",""],[3,"value"],[1,"d-flex","gap-2"],["type","number","placeholder","Fiyat","formControlName","price",1,"form-control"],["type","number","placeholder","S\xFCre (saat)","formControlName","durationHours",1,"form-control"],["formControlName","level",1,"form-select"],["type","text","placeholder","Resim (opsiyonel)","formControlName","image",1,"form-control"],[1,"d-flex","gap-2","mt-2"],["type","submit",1,"btn","btn-success",3,"disabled"],["type","button",1,"btn","btn-outline-danger"],[1,"col-md-3"],[1,"alert","alert-info","p-2","small"],[1,"vstack","gap-2",3,"formGroup"],["type","button",1,"list-group-item","list-group-item-action","d-flex","justify-content-between","align-items-center",3,"click"],[1,"text-start"],[1,"d-block"],[1,"text-muted"],[1,"badge","bg-secondary"],["type","button",1,"btn","btn-outline-danger",3,"click"],["type","text","placeholder","Ders Ba\u015Fl\u0131\u011F\u0131","formControlName","title",1,"form-control"],["type","number","placeholder","S\xFCre (dk)","formControlName","durationMin",1,"form-control"],["type","submit",1,"btn","btn-primary","btn-sm",3,"disabled"]],template:function(t,s){t&1&&(n(0,"div",0)(1,"h3",1),o(2,"Kurs Y\xF6netimi"),i(),_(3,Y,4,0,"div",2)(4,Z,43,5,"div",3),i()),t&2&&(a(3),v(s.loading()?3:4))},dependencies:[F,K,T,L,U,D,A,H,M,V,B,q],encapsulation:2})};export{O as EditCourses};

<app-navbar/>

<div class="profile-container">
  <!-- Loading State -->
  @if (loading()) {
  <div class="loading-section text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Yükleniyor...</span>
    </div>
    <p class="mt-3 text-muted">Profil yükleniyor...</p>
  </div>
  }

  <!-- Error State -->
  @else if (error()) {
  <div class="error-section alert alert-danger text-center mx-3 my-5">
    <i class="bi bi-exclamation-triangle me-2"></i>
    {{ error() }}
    <div class="mt-3">
      <a routerLink="/" class="btn btn-outline-primary btn-sm"
        >Ana Sayfaya Dön</a
      >
    </div>
  </div>
  }

  <!-- Profile Content -->
  @else if (user()) { @let currentUser = user()!;

  <!-- Profile Header -->
  <div class="profile-header text-center py-5 bg-light">
    <div class="container">
      <!-- Avatar -->
      <div class="avatar-section mb-4">
        <div class="avatar-placeholder">
          <i class="bi bi-person-circle display-1 text-primary"></i>
        </div>
      </div>

      <!-- User Info -->
      <h1 class="profile-name display-5 fw-bold text-dark mb-2">
        {{ currentUser.fullName }}
      </h1>

      <p class="profile-email text-muted lead mb-3">{{ currentUser.email }}</p>

      <!-- Role Badge -->
      <div class="role-badge mb-4">
        @if (isInstructor()) {
        <span class="badge bg-success fs-6 px-3 py-2">
          <i class="bi bi-award me-2"></i>Eğitmen
        </span>
        } @else {
        <span class="badge bg-info fs-6 px-3 py-2">
          <i class="bi bi-person me-2"></i>Öğrenci
        </span>
        }
      </div>

      <!-- Stats -->
      <div class="profile-stats row justify-content-center">
        <div class="col-auto">
          <div class="stat-item">
            <span class="stat-number fw-bold">{{ total() }}</span>
            <span class="stat-label text-muted d-block">
              @if (isInstructor()) { Yayınlanan Kurs } @else { Kayıtlı Kurs }
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Courses Section -->
  <div class="courses-section py-5">
    <div class="container">
      <!-- Section Title -->
      <div class="section-header text-center mb-5">
        <h2 class="section-title h3 fw-bold text-dark">
          @if (isInstructor()) {
          <i class="bi bi-collection-play me-2"></i>My Published Courses } @else
          { <i class="bi bi-journal-bookmark me-2"></i>Kayıtlı Olduğum Kurslar }
        </h2>
        <p class="section-subtitle text-muted">
          @if (isInstructor()) { Yayınladığım tüm kurslar aşağıda
          listelenmektedir. } @else { Kayıt olduğum tüm kursları buradan
          görüntüleyebilirim. }
        </p>
      </div>

      <!-- Courses Grid -->
      @if (courses().length > 0) {
      <div class="row g-4">
        @for (course of courses(); track course.id) {
        <div class="col-md-6 col-lg-4">
          <div class="course-card card border-0 shadow-sm h-100">
            <!-- Course Image -->
            <div class="course-image">
              <img
                [src]="course.imageUrl || '/assets/default-course.jpg'"
                [alt]="course.title"
                class="card-img-top"
              />
            </div>

            <!-- Course Body -->
            <div class="card-body d-flex flex-column">
              <h3 class="course-title h5 fw-bold text-dark mb-2">
                {{ course.title }}
              </h3>

              <p class="course-description text-muted small flex-grow-1 mb-3">
                {{ course.description ? (course.description.length > 120 ?
                course.description.substring(0, 120) + '...' :
                course.description) : 'Açıklama yok' }}
              </p>

              <!-- Course Meta -->
              <div
                class="course-meta d-flex justify-content-between align-items-center mb-3"
              >
                <span class="category-badge badge bg-light text-dark">
                  {{ course.category }}
                </span>
              </div>

              <!-- Action Button -->
              <a
                [routerLink]="['/courses', course.id]"
                class="btn btn-outline-primary btn-sm mt-auto"
              >
                <i class="bi bi-arrow-right me-1"></i>
                Kursa Git
              </a>
            </div>
          </div>
        </div>
        }
      </div>

      <!-- Pagination -->
      @if (totalPages() > 1) {
      <div class="pagination-section mt-5 text-center">
        <nav aria-label="Course pagination">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="page() === 1">
              <button
                class="page-link"
                (click)="prevPage()"
                [disabled]="page() === 1"
              >
                <i class="bi bi-chevron-left"></i> Önceki
              </button>
            </li>

            @for (p of [].constructor(totalPages()); track p; let i = $index) {
            <li class="page-item" [class.active]="page() === i + 1">
              <button class="page-link" (click)="page.set(i + 1)">
                {{ i + 1 }}
              </button>
            </li>
            }

            <li class="page-item" [class.disabled]="page() === totalPages()">
              <button
                class="page-link"
                (click)="nextPage()"
                [disabled]="page() === totalPages()"
              >
                Sonraki <i class="bi bi-chevron-right"></i>
              </button>
            </li>
          </ul>
        </nav>
      </div>
      } } @else {
      <!-- Empty State -->
      <div class="empty-state text-center py-5">
        <i class="bi bi-collection display-1 text-muted mb-3"></i>
        <h3 class="h4 text-muted">
          @if (isInstructor()) { Henüz yayınlanmış kurs bulunmuyor } @else {
          Henüz kayıtlı olduğunuz kurs bulunmuyor }
        </h3>
        <p class="text-muted mb-4">
          @if (isInstructor()) { İlk kursunuzu yayınlayarak başlayın! } @else {
          Kurslara göz atıp kayıt olabilirsiniz. }
        </p>
        <a routerLink="/courses" class="btn btn-primary">
          <i class="bi bi-compass me-2"></i>
          Kursları Keşfet
        </a>
      </div>
      }
    </div>
  </div>
  }
</div>
